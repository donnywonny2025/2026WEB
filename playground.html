<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playground â€” Jeffery Kerr</title>
    <meta name="description" content="Interactive playground featuring a curious pixel cat. Still rendering.">
    <link rel="icon" type="image/png" href="jk-monogram.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&family=Space+Grotesk:wght@500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="playground.css?v=8">
</head>

<body>

    <!-- Back link (dynamic â€” returns to referrer context) -->
    <a id="backLink" href="./index.html" class="back-link">
        <svg viewBox="0 0 24 24">
            <line x1="19" y1="12" x2="5" y2="12"></line>
            <polyline points="12 19 5 12 12 5"></polyline>
        </svg>
        Back
    </a>
    <button id="btnWorld1" class="world-btn">World 1</button>
    <button id="btnWorld2" class="world-btn" style="top:95px">World 2</button>
    <button id="btnWorld3" class="world-btn" style="top:130px">World 3</button>
    <button id="btnWorld4" class="world-btn" style="top:165px">World 4</button>

    <!-- Audio toggle -->
    <button id="audioToggle" class="audio-toggle" title="Toggle ambient jazz">
        <div class="eq-bars">
            <span class="eq-bar"></span>
            <span class="eq-bar"></span>
            <span class="eq-bar"></span>
            <span class="eq-bar"></span>
        </div>
    </button>

    <!-- Hidden YouTube player -->
    <div id="ytPlayerWrap"
        style="position:fixed;top:-9999px;left:-9999px;width:1px;height:1px;overflow:hidden;pointer-events:none;">
        <div id="ytPlayer"></div>
    </div>

    <!-- Logo -->
    <div class="floating-logo">
        <a id="logoLink" href="./index.html"><img src="./jk-monogram.png" alt="JK"></a>
    </div>

    <!-- Forest background -->
    <div class="forest-layer" id="forestLayer"></div>
    <div class="ground-fade"></div>

    <!-- Main content -->
    <div class="coming-soon">
        <div class="label" id="labelEl">Playground</div>
        <h1 id="headingEl"><span>Still<br>Rendering</span></h1>
        <div class="accent-line" id="accentLine"></div>
        <p class="sub">This page is a living experiment. Poke around.</p>
    </div>

    <!-- Foxy canvas -->
    <canvas id="foxyCanvas"></canvas>

    <!-- Thought bubble -->
    <div id="thoughtBubble" class="thought-bubble">
        <div class="thought-text" id="thoughtText"></div>
        <div class="thought-tail"></div>
        <div class="thought-tail-sm"></div>
    </div>

    <!-- Question bubble -->
    <div id="questionBubble" class="question-bubble">
        <div class="question-text" id="questionText"></div>
        <div class="question-options" id="questionOptions"></div>
        <div class="question-tail"></div>
        <div class="thought-tail-sm"></div>
    </div>

    <!-- Mood badge -->
    <div id="moodBadge" class="mood-badge"></div>

    <!-- AI status -->
    <div class="ai-status" id="aiStatus">
        <span class="dot" id="aiDot"></span>brain online
    </div>

    <!-- Need icons (appear above Foxy when needs are low) -->
    <div id="foxyNeedIcons" class="foxy-need-icons"></div>

    <!-- Chat with Foxy -->
    <div class="foxy-chat" id="foxyChat">
        <input type="text" id="foxyChatInput" placeholder="Talk to Foxy..." maxlength="100" autocomplete="off">
        <button id="foxyChatSend" class="foxy-btn">ðŸ’¬</button>
    </div>

    <!-- Forest generator -->
    <script src="forest-gen.js"></script>
    <script src="foxy-buddy.js"></script>

    <!-- Foxy modular system (load order matters) -->
    <script src="foxy-soul.js"></script>
    <script src="foxy-body.js"></script>
    <script src="foxy-world.js"></script>
    <script src="foxy-brain.js"></script>
    <!-- YouTube IFrame API -->
    <script src="https://www.youtube.com/iframe_api"></script>

    <script>
        // â”€â”€â”€ Context-aware back routing â”€â”€â”€
        (function () {
            const params = new URLSearchParams(window.location.search);
            const fromPolitical = params.get('from') === 'political' ||
                document.referrer.includes('site-political');
            if (fromPolitical) {
                const backUrl = '/site-political/';
                document.getElementById('backLink').href = backUrl;
                document.getElementById('logoLink').href = backUrl;
            }
        })();

        // â”€â”€â”€ World navigation â”€â”€â”€
        document.getElementById('btnWorld1').addEventListener('click', () => {
            window.location.href = './world1.html';
        });
        document.getElementById('btnWorld2').addEventListener('click', () => {
            window.location.href = './world2.html';
        });
        document.getElementById('btnWorld3').addEventListener('click', () => {
            window.location.href = './world3.html';
        });
        document.getElementById('btnWorld4').addEventListener('click', () => {
            window.location.href = './playground.html';
        });

        // â”€â”€â”€ Ambient Jazz (YouTube IFrame API) â”€â”€â”€
        var ytReady = false;
        var player = null;
        var isUnmuted = false;
        var audioBtn = document.getElementById('audioToggle');

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('ytPlayer', {
                videoId: 'ziOus5-1kXw',
                playerVars: {
                    autoplay: 1,
                    controls: 0,
                    disablekb: 1,
                    fs: 0,
                    modestbranding: 1,
                    rel: 0,
                    showinfo: 0,
                    loop: 1,
                    playlist: 'ziOus5-1kXw'
                },
                events: {
                    onReady: function (e) {
                        ytReady = true;
                        e.target.mute();
                        e.target.setVolume(15);
                        e.target.playVideo();
                        // Bars animate immediately in muted/dim state
                        audioBtn.classList.add('animating');
                    },
                    onStateChange: function (e) {
                        if (e.data === YT.PlayerState.ENDED) {
                            player.seekTo(0);
                            player.playVideo();
                        }
                        // Ensure animation starts when playback begins
                        if (e.data === YT.PlayerState.PLAYING && !audioBtn.classList.contains('animating')) {
                            audioBtn.classList.add('animating');
                        }
                    }
                }
            });
        }

        audioBtn.addEventListener('click', function () {
            if (!ytReady || !player) return;
            if (isUnmuted) {
                // Mute â€” bars keep bouncing but go dim
                player.mute();
                isUnmuted = false;
                audioBtn.classList.remove('playing');
            } else {
                // Unmute â€” bars light up accent orange
                player.unMute();
                player.setVolume(15);
                isUnmuted = true;
                audioBtn.classList.add('playing');
            }
        });
    </script>

</body>

</html>